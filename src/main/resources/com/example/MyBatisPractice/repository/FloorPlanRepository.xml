<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
    namespace="com.example.MyBatisPractice.repository.FloorPlanRepository">

	<!-- Section4_17：練習問題：FloorPlanテーブルから全件取得 -->
	<select id="selectAll" resultType="FloorPlan">
SELECT
      id
    , floor_plan_name AS floorPlanName
FROM
    floor_plan
	</select>

	<!-- Section5_21：練習問題：FloorPlanテーブルから１件取得 -->
	<!-- <select id="selectById" resultType="FloorPlan" parameterType="int"> -->
	<!-- int を Integer としても、ちゃんと動く。 -->
	<select id="selectById" resultType="FloorPlan" parameterType="Integer">
SELECT
      id
    , floor_plan_name AS floorPlanName
FROM
    floor_plan
WHERE
	id = #{id}
	</select>

	<!-- Section8：<resultMap> 複数のテーブルを結合する！複雑だけど、ゆっくり学習しよう！ -->

	<!-- Section8_23：collection（１対多） -->
	<resultMap id="floorPlanResult" type="FloorPlan">
		<!-- 主キー -->
		<id property="id" column="id" />

		<!-- 主キー以外 -->
		<result property="floorPlanName" column="floor_plan_name" />

		<collection property="mansions" ofType="Mansion">
			<id property="id" column="id" />
			<result property="name" column="name" />
			<result property="address" column="address" />
			<result property="station" column="station" />
			<result property="floorPlanId" column="floor_plan_id" />
			<result property="buildingDate" column="building_date" />
			<result property="status" column="status" />
		</collection>
	</resultMap>

	<!-- Section8_23：collection（１対多） -->
	<select id="selectByFloorPlanIdWithMansion" resultMap="floorPlanResult" >
SELECT
		m.id
	,	m.name
	,	m.address
	,	m.station
	,	m.floor_plan_id
	,	m.building_date
	,	m.status
	,	f.id
	,	f.floor_plan_name
FROM
	mansion m INNER JOIN floor_plan f ON m.floor_plan_id = f.id
WHERE
	m.floor_plan_id = #{id}
	</select>

</mapper>